<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>MidiClick</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
    <style>
          html, body {
            padding:0;
            margin:0;
            width:100%;
          }

          .container-fluid {
            display: table;
          }

          .logo {
            text-align: center;
            vertical-align: top;
            height: 25%;
            display: table-cell;
          }
          .title {
            text-align: center;
            vertical-align: center;
            font-size: xxx-large;
            display: table-cell;
            height: 25%;
          }

          .legend {
            height: 12.5%;
            text-align: center;
            vertical-align: center;
            display: table-cell;
          }

          .slider {
            height: 12.5%;
            vertical-align: center;
            display: table-cell;
          }

          .tempo {
            font-size: xx-large;
            text-align: center;
            background-color: red;
            vertical-align: center;
            width: 150px;
            display: table-cell;
                        border: dashed;
          }

          .meter {
            background-color:  #5dade2;
            font-size: xxx-large;
            font-family: "Bravura";
          }

          .gadget {
            text-align: center;
            vertical-align: center;
            display: table-cell;
          }

          .spinbox {
            border: dashed;
          }

          .row {
            border: dashed;
            display: table-row;
            height: 12.5%;
          }
          </style>
  </head>
  <body onload="on_load()">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"
          integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA=="
          crossorigin="anonymous"></script>

    <script>
      let socket = io();
      let settings = {};

      function format_meter()
      {
        let meter = parseInt(document.getElementById("measure_length").value);
        switch (meter)
        {
          case 2: meter = "\uE082";  break;
          case 3: meter = "\uE083";  break;
          case 4: meter = "\uE084";  break;
          case 5: meter = "\uE085";  break;
          case 6: meter = "\uE086";  break;
          case 7: meter = "\uE087";  break;
          case 9: meter = "\uE089";  break;
          case 12: meter = "\uE081  \uE082";  break;
          default:
            meter = "\uE084";
        }
        return meter;
      }

      function send_updates()
      {
        settings["tempo_output"    ] = document.getElementById("tempo_output").value;
        settings["measure_options" ] = document.getElementById("measure_options").value;
        settings["measure_length"  ] = document.getElementById("measure_length").value;
        settings["measure_volume"  ] = document.getElementById("measure_volume").value;
        settings["beat_volume"     ] = document.getElementById("beat_volume").value;
        settings["eighth_volume"   ] = document.getElementById("eighth_volume").value;
        settings["swing_value"     ] = document.getElementById("swing_value").value;
        settings["sixteenth_volume"] = document.getElementById("sixteenth_volume").value;
        socket.emit("push_params", settings);
      }

      function update_tempo_drag()
      {
        let tempo_val = document.getElementById("tempo_slider").value.padEnd(3);
        document.getElementById("tempo_output").value = document.getElementById("tempo_slider").value;
      }

      function meter_clicked(button_id)
      {
        let meters = document.getElementById("measure_options").value.split(",").map(Number);
        let current_meter = parseInt(document.getElementById("measure_length").value);
        let meter_idx = meters.indexOf(current_meter);

        if (button_id == "meter_up" && (meter_idx < meters.length - 1))
        {
          meter_idx += 1;
        } else if (button_id == "meter_down" && meter_idx > 0)
        {
            meter_idx -= 1;
        }
        document.getElementById("measure_length").value = meters[meter_idx];
        document.getElementById("measure_length_display").value = format_meter();
        send_updates();
      }
    </script>

    <div class="container-fluid">
      <div class="row">
        <div class="logo">
          <img alt="Mclick Logo" src="../static/mclick.svg">
        </div> <!-- cell -->
        <div class="title">
          MIDI Click
        </div>
      </div>
    </div>  <!-- table -->

    <div class="container-fluid">

      <!-- Tempo -->
      <div class="row">
        <div class="tempo">
          <output class="param_text" id="tempo_output"> {{ parameters.tempo }}</output>
        </div>
        <div class="slider">
            <input type="range" id="tempo_slider" min=40 max=240 value={{ parameters.tempo }} class="slider" oninput="update_tempo_drag()" onchange="send_updates()" >
        </div>
        <div class=gadget></div>
      </div>

      <!-- Measure -->
      <div class="row">
        <div class="legend">
          <div class="meter">
              <!--img alt="num beats" id="measure_length_img" src="../static/{{ parameters.measure_length }}.svg" -->
              <output id="measure_length_display" readonly > </output>
              <input id="measure_length"  type="hidden" readonly value="{{ parameters.measure_length }}" >
              <input id="measure_options" type="hidden" readonly value="{{ parameters.measure_options }}" >
              <script type="text/javascript">
                document.getElementById("measure_length_display").value = format_meter();
              </script>
          </div>
          <div class="spinbox">
            <div class="row">
                <button type="button" onclick="meter_clicked(this.id)" id="meter_up" title="up">/\</button>
            </div>
            <div class="row">
                <button type="button"  onclick="meter_clicked(this.id)" id="meter_down" title="down">\/</button>
            </div>
          </div>
        </div>
        <div class="slider">
              <input class="slider" id="measure_volume" type="range" min=0 max=127 value={{ parameters.measure_volume }} onchange="send_updates()">
          </div>
        <div class=gadget></div>
      </div> <!-- row -->

      <!-- Beat -->
      <div class="row">
          <div class="legend">
            <img alt="beat" src="../static/quarter.svg" style="icon">
          </div>
          <div class="slider">
              <input type="range" min=0 max=127 value={{ parameters.beat_volume }}
                  class="slider"  id="beat_volume" onchange="send_updates()">
          </div>   <!-- display:table-cell -->
          <div class=gadget></div>
      </div>

        <!-- Eights -->
      <div class="row">
            <div class="legend">
                <img alt="eighths" src="../static/eighth.svg" style="icon">
          </div>   <!-- display:table-cell -->
          <div class="slider">
              <input class="slider"  id="eighth_volume" type="range" min=0 max=127 value={{ parameters.eighth_volume }} onchange="send_updates()" >
          </div>
          <div class=gadget></div>
      </div>

      <!-- Swing -->
      <div class="row">
          <div class="legend">
              <img alt="straight" src="../static/straight.svg" style="icon">
          </div>
          <div class="slider">
              <input class="slider" id="swing_value" type="range" min=0 max=100 value={{ parameters.swing_value }} onchange="send_updates()">
        </div>
        <div class="gadget">
            <img alt="swing" src="../static/swing.svg" >
        </div>
      </div>

        <!-- Sixteenths -->
        <div class="row">
            <div class="legend">
            <img alt="sixteenths" src="../static/sixteenth.svg" style="icon">
          </div>   <!-- display:table-cell -->
          <div class="slider">
                <input class="slider"  id="sixteenth_volume" type="range" min=0 max=127 value={{ parameters.sixteenth_volume }} step="any" onchange="send_updates()">
          </div>
          <div class=gadget></div>
        </div>
    </div>
  </body>
</html>
